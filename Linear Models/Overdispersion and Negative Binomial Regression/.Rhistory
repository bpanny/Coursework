fit_5 <- update(fit_nb, . ~ race)
fil_6 <- update(nb_1, . ~ privins)
fil_7 <- update(nb_1, . ~ cond)
fil_8 <- update(nb_1, . ~ edu)
fil_9 <- update(nb_1, . ~ privins)
fit_null <- update(fit_nb, . ~ 1)
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(fit_nb, . ~ health)
fit_3 <- update(fit_nb, . ~ sex)
fit_4 <- update(fit_nb, . ~ adldiff)
fit_5 <- update(fit_nb, . ~ race)
fil_6 <- update(nb_1, . ~ privins)
fil_7 <- update(nb_1, . ~ cond)
fil_8 <- update(nb_1, . ~ edu)
fil_9 <- update(nb_1, . ~ privins)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2],
as.character(fit_9$terms)[-(1:2)], anova(fit_9, fit_null)$`Pr(Chi)`[2],
)
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_2, . ~ health)
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fil_6 <- update(nb_1, . ~ privins)
fil_7 <- update(nb_1, . ~ cond)
fil_8 <- update(nb_1, . ~ edu)
fil_9 <- update(nb_1, . ~ privins)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2],
as.character(fit_9$terms)[-(1:2)], anova(fit_9, fit_null)$`Pr(Chi)`[2],
)
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fil_6 <- update(nb_1, . ~ privins)
fil_7 <- update(nb_1, . ~ cond)
fil_8 <- update(nb_1, . ~ edu)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2],
as.character(fit_9$terms)[-(1:2)], anova(fit_9, fit_null)$`Pr(Chi)`[2],
)
fit_6
nb_1
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fil_6 <- update(nb_1, . ~ privinsyes)
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fil_6 <- update(nb_1, . ~ privins)
fil_7 <- update(nb_1, . ~ cond)
fil_8 <- update(nb_1, . ~ edu)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2],
as.character(fit_9$terms)[-(1:2)], anova(fit_9, fit_null)$`Pr(Chi)`[2],
)
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fit_6 <- update(nb_1, . ~ privins)
fit_7 <- update(nb_1, . ~ cond)
fit_8 <- update(nb_1, . ~ edu)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2],
as.character(fit_9$terms)[-(1:2)], anova(fit_9, fit_null)$`Pr(Chi)`[2],
)
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fit_6 <- update(nb_1, . ~ privins)
fit_7 <- update(nb_1, . ~ cond)
fit_8 <- update(nb_1, . ~ edu)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2])
glm_2 <- glm(visit ~ health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
exp(glm_2$coefficients[2])
summary(glm-2)
summary(glm_2)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sandwich)
library(lmtest)
library(patchwork)
source("alr_utility.R")
dat <- read_csv("arsenic.csv") %>% mutate(
exp = factor(exp, levels=0:1, labels=c("Low", "High")),
age = factor(age, levels=1:4, labels=c("40-49","50-59", "60-69", "70-79")),
calper = factor(calper, levels=1:4, labels=c("1938-49", "1950-59", "1960-69", "1970-79"))
)
alr_plot_residual(glm_2, x="Predicted", bubble=T)
alr_plot_residual(glm_2, x="Predicted", bubble=T)
alr_plot_cookd(glm_2, x="Predicted")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(table1)
library(sandwich)
library(lmtest)
library(table1)
library(patchwork)
source("alr_utility.R")
dat <- read_csv("DA6.csv") %>% mutate(health = factor(health, levels=1:3,
labels=c("poor", "average", "excellent")),
sex = factor(sex, levels=0:1,
labels=c("female","male")),
adldiff = factor(adldiff, levels=0:1,
labels=c("no", "yes")),
race = factor(race, levels=0:1,
labels=c("other","Black")),
privins = factor(privins, levels=1:0,
labels=c("no","yes")))
glm_1 <- glm(visit ~ ., family = poisson(link = 'log'), data = dat)
exp(glm_1$coefficients[2])
# Create the table1
tbl1 <- table1(~ ., data = dat)
tbl1
AER::dispersiontest(glm_1, trafo=NULL)
ggplot(dat, aes(x = visit, fill = health)) + geom_bar(stat = 'count')
dat$privins_label <- paste("Private Insurance Indicator:", dat$privins)
dat %>% ggplot(aes(x = visit, fill = health)) +
geom_bar(width = 0.95) +
facet_wrap(~privins_label) +
theme_minimal()
quantiles <- dat$visit %>% quantile(., c(.05, .10, .125,.25,.5,.75,.875,.95), type = 1, names = TRUE)
kableExtra::kable(tibble(Percentile = names(quantiles), `Number of Physician Office Visits` = quantiles)) %>% kableExtra::kable_styling()
dat_cdf <- dat %>% group_by(visit) %>% summarise(n=n()) %>% mutate(cumulative = cumsum(n))
plot(dat_cdf$visit, dat_cdf$cumulative)
paste("sample size:", dat_cdf$cumulative[nrow(dat_cdf)])
nb_1 = MASS::glm.nb(visit ~ ., data = dat)
summary(nb_1)
dat
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fil_6 <- update(nb_1, . ~ privins)
fil_7 <- update(nb_1, . ~ cond)
fil_8 <- update(nb_1, . ~ edu)
fil_9 <- update(nb_1, . ~ privins)
fit_null <- update(nb_1, . ~ 1)
dispersion_parameter = sum(resid(nb_1,type ="pearson")^2)/nb_1$df.residual
dispersion_parameter
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fit_6 <- update(nb_1, . ~ privins)
fit_7 <- update(nb_1, . ~ cond)
fit_8 <- update(nb_1, . ~ edu)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2])
glm_2 <- glm(visit ~ health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
summary(glm_2)
glht_2 <- multcomp::glht(glm_2, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, 1, 1, -1, 0, 0, 1, -1)))
(glht_2_summary <- summary(glht_2))
glht_2_summary
alr_plot_residual(glm_2, x="Predicted", bubble=T)
alr_plot_cookd(glm_2, x="Predicted")
# Create the table1
tbl1 <- table1(~ ., data = dat)
tbl1
print(tbl1)
glm_2
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sandwich)
library(lmtest)
library(patchwork)
source("alr_utility.R")
dat <- read_csv("arsenic.csv") %>% mutate(
exp = factor(exp, levels=0:1, labels=c("Low", "High")),
age = factor(age, levels=1:4, labels=c("40-49","50-59", "60-69", "70-79")),
calper = factor(calper, levels=1:4, labels=c("1938-49", "1950-59", "1960-69", "1970-79"))
)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(table1)
library(sandwich)
library(lmtest)
library(table1)
library(patchwork)
source("alr_utility.R")
dat <- read_csv("DA6.csv") %>% mutate(health = factor(health, levels=1:3,
labels=c("poor", "average", "excellent")),
sex = factor(sex, levels=0:1,
labels=c("female","male")),
adldiff = factor(adldiff, levels=0:1,
labels=c("no", "yes")),
race = factor(race, levels=0:1,
labels=c("other","Black")),
privins = factor(privins, levels=1:0,
labels=c("no","yes")))
glm_1 <- glm(visit ~ ., family = poisson(link = 'log'), data = dat)
exp(glm_1$coefficients[2])
# Create the table1
tbl1 <- table1(~ ., data = dat)
tbl1
AER::dispersiontest(glm_1, trafo=NULL)
ggplot(dat, aes(x = visit, fill = health)) + geom_bar(stat = 'count')
dat$privins_label <- paste("Private Insurance Indicator:", dat$privins)
dat %>% ggplot(aes(x = visit, fill = health)) +
geom_bar(width = 0.95) +
facet_wrap(~privins_label) +
theme_minimal()
quantiles <- dat$visit %>% quantile(., c(.05, .10, .125,.25,.5,.75,.875,.95), type = 1, names = TRUE)
kableExtra::kable(tibble(Percentile = names(quantiles), `Number of Physician Office Visits` = quantiles)) %>% kableExtra::kable_styling()
dat_cdf <- dat %>% group_by(visit) %>% summarise(n=n()) %>% mutate(cumulative = cumsum(n))
plot(dat_cdf$visit, dat_cdf$cumulative)
paste("sample size:", dat_cdf$cumulative[nrow(dat_cdf)])
nb_1 = MASS::glm.nb(visit ~ ., data = dat)
summary(nb_1)
dat
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fil_6 <- update(nb_1, . ~ privins)
fil_7 <- update(nb_1, . ~ cond)
fil_8 <- update(nb_1, . ~ edu)
fil_9 <- update(nb_1, . ~ privins)
fit_null <- update(nb_1, . ~ 1)
dispersion_parameter = sum(resid(nb_1,type ="pearson")^2)/nb_1$df.residual
dispersion_parameter
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fit_6 <- update(nb_1, . ~ privins)
fit_7 <- update(nb_1, . ~ cond)
fit_8 <- update(nb_1, . ~ edu)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2])
glm_2 <- glm(visit ~ health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
summary(glm_2)
glht_2 <- multcomp::glht(glm_2, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, 1, 1, -1, 0, 0, 1, -1)))
(glht_2_summary <- summary(glht_2))
glht_2_summary
alr_plot_residual(glm_2, x="Predicted", bubble=T)
alr_plot_cookd(glm_2, x="Predicted")
glm_2
glm_2_w_sex <- glm(visit ~ sex + health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
glm_2_w_sex
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(table1)
library(sandwich)
library(lmtest)
library(table1)
library(patchwork)
source("alr_utility.R")
dat <- read_csv("DA6.csv") %>% mutate(health = factor(health, levels=1:3,
labels=c("poor", "average", "excellent")),
sex = factor(sex, levels=0:1,
labels=c("female","male")),
adldiff = factor(adldiff, levels=0:1,
labels=c("no", "yes")),
race = factor(race, levels=0:1,
labels=c("other","Black")),
privins = factor(privins, levels=1:0,
labels=c("no","yes")))
glm_1 <- glm(visit ~ ., family = poisson(link = 'log'), data = dat)
exp(glm_1$coefficients[2])
# Create the table1
tbl1 <- table1(~ ., data = dat)
tbl1
AER::dispersiontest(glm_1, trafo=NULL)
ggplot(dat, aes(x = visit, fill = health)) + geom_bar(stat = 'count')
dat$privins_label <- paste("Private Insurance Indicator:", dat$privins)
dat %>% ggplot(aes(x = visit, fill = health)) +
geom_bar(width = 0.95) +
facet_wrap(~privins_label) +
theme_minimal()
quantiles <- dat$visit %>% quantile(., c(.05, .10, .125,.25,.5,.75,.875,.95), type = 1, names = TRUE)
kableExtra::kable(tibble(Percentile = names(quantiles), `Number of Physician Office Visits` = quantiles)) %>% kableExtra::kable_styling()
dat_cdf <- dat %>% group_by(visit) %>% summarise(n=n()) %>% mutate(cumulative = cumsum(n))
plot(dat_cdf$visit, dat_cdf$cumulative)
paste("sample size:", dat_cdf$cumulative[nrow(dat_cdf)])
nb_1 = MASS::glm.nb(visit ~ ., data = dat)
summary(nb_1)
dat
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fil_6 <- update(nb_1, . ~ privins)
fil_7 <- update(nb_1, . ~ cond)
fil_8 <- update(nb_1, . ~ edu)
fil_9 <- update(nb_1, . ~ privins)
fit_null <- update(nb_1, . ~ 1)
dispersion_parameter = sum(resid(nb_1,type ="pearson")^2)/nb_1$df.residual
dispersion_parameter
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fit_6 <- update(nb_1, . ~ privins)
fit_7 <- update(nb_1, . ~ cond)
fit_8 <- update(nb_1, . ~ edu)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2])
glm_2 <- glm(visit ~ health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
summary(glm_2)
glm_2_w_sex <- glm(visit ~ sex + health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
glht_2 <- multcomp::glht(glm_2, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, -1, 1, 0, 0, 0, -3, 0)))
(glht_2_summary <- summary(glht_2))
glht_2_w_sex <- multcomp::glht(glm_2, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, 1, -1, 1, 0, 0, 0, -3, 0)))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(table1)
library(sandwich)
library(lmtest)
library(table1)
library(patchwork)
source("alr_utility.R")
dat <- read_csv("DA6.csv") %>% mutate(health = factor(health, levels=1:3,
labels=c("poor", "average", "excellent")),
sex = factor(sex, levels=0:1,
labels=c("female","male")),
adldiff = factor(adldiff, levels=0:1,
labels=c("no", "yes")),
race = factor(race, levels=0:1,
labels=c("other","Black")),
privins = factor(privins, levels=1:0,
labels=c("no","yes")))
glm_1 <- glm(visit ~ ., family = poisson(link = 'log'), data = dat)
exp(glm_1$coefficients[2])
# Create the table1
tbl1 <- table1(~ ., data = dat)
tbl1
AER::dispersiontest(glm_1, trafo=NULL)
ggplot(dat, aes(x = visit, fill = health)) + geom_bar(stat = 'count')
dat$privins_label <- paste("Private Insurance Indicator:", dat$privins)
dat %>% ggplot(aes(x = visit, fill = health)) +
geom_bar(width = 0.95) +
facet_wrap(~privins_label) +
theme_minimal()
quantiles <- dat$visit %>% quantile(., c(.05, .10, .125,.25,.5,.75,.875,.95), type = 1, names = TRUE)
kableExtra::kable(tibble(Percentile = names(quantiles), `Number of Physician Office Visits` = quantiles)) %>% kableExtra::kable_styling()
dat_cdf <- dat %>% group_by(visit) %>% summarise(n=n()) %>% mutate(cumulative = cumsum(n))
plot(dat_cdf$visit, dat_cdf$cumulative)
paste("sample size:", dat_cdf$cumulative[nrow(dat_cdf)])
nb_1 = MASS::glm.nb(visit ~ ., data = dat)
summary(nb_1)
dat
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fil_6 <- update(nb_1, . ~ privins)
fil_7 <- update(nb_1, . ~ cond)
fil_8 <- update(nb_1, . ~ edu)
fil_9 <- update(nb_1, . ~ privins)
fit_null <- update(nb_1, . ~ 1)
dispersion_parameter = sum(resid(nb_1,type ="pearson")^2)/nb_1$df.residual
dispersion_parameter
fit_1 <- update(nb_1, . ~ age)
fit_2 <- update(nb_1, . ~ health)
fit_3 <- update(nb_1, . ~ sex)
fit_4 <- update(nb_1, . ~ adldiff)
fit_5 <- update(nb_1, . ~ race)
fit_6 <- update(nb_1, . ~ privins)
fit_7 <- update(nb_1, . ~ cond)
fit_8 <- update(nb_1, . ~ edu)
options(scipen=999)
tribble(~predictor, ~`p-value`,
as.character(fit_1$terms)[-(1:2)], anova(fit_1, fit_null)$`Pr(Chi)`[2],
as.character(fit_2$terms)[-(1:2)], anova(fit_2, fit_null)$`Pr(Chi)`[2],
as.character(fit_3$terms)[-(1:2)], anova(fit_3, fit_null)$`Pr(Chi)`[2],
as.character(fit_4$terms)[-(1:2)], anova(fit_4, fit_null)$`Pr(Chi)`[2],
as.character(fit_5$terms)[-(1:2)], anova(fit_5, fit_null)$`Pr(Chi)`[2],
as.character(fit_6$terms)[-(1:2)], anova(fit_6, fit_null)$`Pr(Chi)`[2],
as.character(fit_7$terms)[-(1:2)], anova(fit_7, fit_null)$`Pr(Chi)`[2],
as.character(fit_8$terms)[-(1:2)], anova(fit_8, fit_null)$`Pr(Chi)`[2])
glm_2 <- glm(visit ~ health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
summary(glm_2)
glm_2_w_sex <- glm(visit ~ sex + health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
glht_2 <- multcomp::glht(glm_2, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, -1, 1, 0, 0, 0, -3, 0)))
(glht_2_summary <- summary(glht_2))
glht_2_w_sex <- multcomp::glht(glm_2_w_sex, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, 1, -1, 1, 0, 0, 0, -3, 0)))
(glht_2_w_sex_summary <- summary(glht_2_w_sex))
alr_plot_residual(glm_2, x="Predicted", bubble=T)
alr_plot_cookd(glm_2, x="Predicted")
glht_2_summary
glht_2_w_sex_summary
glm_2 <- glm(visit ~ health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
summary(glm_2)
glm_2_w_sex <- glm(visit ~ sex + health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
glht_2 <- multcomp::glht(glm_2, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, -1, 1, 0, 0, 0, 3, 0)))
(glht_2_summary <- summary(glht_2))
glht_2_w_sex <- multcomp::glht(glm_2_w_sex, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, 1, -1, 1, 0, 0, 0, 3, 0)))
(glht_2_w_sex_summary <- summary(glht_2_w_sex))
glm_2 <- glm(visit ~ health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
summary(glm_2)
glm_2_w_sex <- glm(visit ~ sex + health + adldiff + race + privins + cond + edu, family = poisson(link = 'log'), data = dat)
glht_2 <- multcomp::glht(glm_2, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, -1, 1, 0, 0, 0, -3, 0)))
(glht_2_summary <- summary(glht_2))
glht_2_w_sex <- multcomp::glht(glm_2_w_sex, linfct = rbind("50yo M excellent health 2 chronic conditions vs 50 yo F average health 5 chronic conditions" = c(0, 1, -1, 1, 0, 0, 0, -3, 0)))
(glht_2_w_sex_summary <- summary(glht_2_w_sex))
exp(-.7015)
glht_2_summary$model
glht_2_summary$model$contrasts
glht_2_summary$test$coefficients
glht_2_summary$test$coefficients[1]
glht_2_summary$test$coefficients[1]+1
glht_2_summary$test$sigma[1]
estimate <- glht_2_summary$test$coefficients[1]
standard_error <- glht_2_summary$test$sigma[1]
lower_bound_log <- estimate - (1.96 * standard_error)
upper_bound_log <- estimate + (1.96 * standard_error)
lower_bound_rate_ratio <- exp(lower_bound_log)
upper_bound_rate_ratio <- exp(upper_bound_log)
cat("95% Confidence Interval for the Rate Ratio:", "(", lower_bound_rate_ratio, ",", upper_bound_rate_ratio, ")\n")
cat("95% Confidence Interval for the Rate Ratio:", "(", lower_bound_rate_ratio, ",", upper_bound_rate_ratio, ")")
estimate <- glht_2_summary$test$coefficients[1]
standard_error <- glht_2_summary$test$sigma[1]
lower_bound_log <- estimate - (1.96 * standard_error)
upper_bound_log <- estimate + (1.96 * standard_error)
lower_bound_rate_ratio <- exp(lower_bound_log)
upper_bound_rate_ratio <- exp(upper_bound_log)
cat("95% Confidence Interval for the Rate Ratio:", "(", lower_bound_rate_ratio, ",", upper_bound_rate_ratio, ")")
